import numpy as np

"""Metrics from the More than Forgetting (MtF) paper (acc, ft, btw+, rem)."""

# Accuracy matrices

## hnppo+fc (series4)
s4a = [[1.0, 0.8, 0.0, 0.0, 0.0, 0.01], [1.0, 1.0, 0.0, 0.0, 0.0, 0.0], [1.0, 1.0, 0.97, 0.01, 0.0, 0.0],
       [1.0, 1.0, 0.97, 0.91, 0.0, 0.0], [1.0, 1.0, 0.98, 0.8, 0.76, 0.0], [1.0, 1.0, 0.95, 0.78, 0.76, 0.0]]
s4b = [[1.0, 0.0, 0.0, 0.0, 0.02, 0.0], [1.0, 1.0, 0.0, 0.0, 0.0, 0.0], [1.0, 1.0, 0.18, 0.0, 0.0, 0.0],
       [1.0, 1.0, 0.19, 0.0, 0.0, 0.49], [1.0, 1.0, 0.19, 0.0, 0.0, 0.0], [1.0, 1.0, 0.14, 0.0, 0.0, 0.04]]
s4c = [[1.0, 0.54, 0.0, 0.0, 0.0, 0.0], [1.0, 1.0, 0.0, 0.0, 0.0, 0.0], [1.0, 1.0, 0.91, 0.0, 0.0, 0.0],
       [1.0, 1.0, 0.9, 0.18, 0.0, 0.0], [1.0, 0.98, 0.92, 0.22, 0.0, 0.0], [1.0, 0.99, 0.94, 0.15, 0.0, 0.0]]

## ppo finetuning (series8)
s8a = [[1.0, 0.54, 0.0, 0.0, 0.0, 0.0], [0.82, 1.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.11, 0.0, 0.0, 0.9, 0.0],
       [0.0, 0.0, 0.0, 0.0, 0.0, 0.97], [0.0, 0.0, 0.0, 0.0, 0.93, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.95]]
s8b = [[1.0, 0.0, 0.0, 0.0, 0.01, 0.0], [0.0, 1.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.07, 0.0, 0.0, 0.43, 0.0],
       [0.0, 0.0, 0.0, 0.0, 0.0, 0.19], [0.0, 0.0, 0.0, 0.0, 0.18, 0.0], [0.0, 0.02, 0.0, 0.0, 0.0, 0.1]]
s8c = [[1.0, 0.08, 0.0, 0.0, 0.0, 0.0], [1.0, 1.0, 0.0, 0.0, 0.01, 0.0], [0.0, 0.55, 0.0, 0.0, 0.25, 0.01],
       [0.0, 0.02, 0.0, 0.0, 0.0, 0.89], [0.58, 0.17, 0.81, 0.0, 0.0, 0.0], [0.02, 0.12, 0.0, 0.0, 0.0, 0.02]]

## ablation (series9)
s9a = [[1.0, 0.8, 0.0, 0.0, 0.0, 0.01], [0.99, 1.0, 0.0, 0.0, 0.0, 0.0], [0.94, 0.0, 0.94, 0.0, 0.0, 0.0],
       [0.0, 0.09, 0.0, 0.96, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.93, 0.0], [0.0, 0.03, 0.0, 0.0, 0.0, 0.0]]
s9b = [[1.0, 0.0, 0.0, 0.0, 0.02, 0.0], [0.0, 1.0, 0.0, 0.0, 0.0, 0.03], [0.0, 0.0, 0.39, 0.0, 0.0, 0.0],
       [0.0, 0.0, 0.0, 0.91, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.94, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0]]
s9c = [[1.0, 0.54, 0.0, 0.0, 0.0, 0.0], [0.99, 1.0, 0.0, 0.0, 0.0, 0.0], [0.04, 0.0, 0.0, 0.0, 0.0, 0.0],
       [0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.61, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.11]]

for series in [[s4a, s4b, s4c],
               # [s5a, s5b, s5c],
               # [s6a, s6b, s6c],
               # [s7a, s7b, s7c],
               [s8a, s8b, s8c],
               [s9a, s9b, s9c],
               ]:
    total = np.stack(series)
    print("average matrix:", np.round(np.average(total, axis=0), decimals=2).tolist())

series4_mtfs = [{'accuracy': 0.8990476190476192,
                 'forward_transfer': 0.05466666666666667,
                 'backward_transfer_pos': 0,
                 'remembering': 0.9833333333333333},
                {'accuracy': 0.559047619047619,
                 'forward_transfer': 0.034,
                 'backward_transfer_pos': 0,
                 'remembering': 0.9986666666666667},
                {'accuracy': 0.7233333333333333,
                 'forward_transfer': 0.036000000000000004,
                 'backward_transfer_pos': 0.0006666666666666598,
                 'remembering': 1}
                ]

series8_mtfs = [{'accuracy': 0.22904761904761903,
                 'forward_transfer': 0.16066666666666668,
                 'backward_transfer_pos': 0,
                 'remembering': 0.4},
                {'accuracy': 0.11285714285714286,
                 'forward_transfer': 0.042,
                 'backward_transfer_pos': 0,
                 'remembering': 0.394},
                {'accuracy': 0.2519047619047619,
                 'forward_transfer': 0.08266666666666667,
                 'backward_transfer_pos': 0,
                 'remembering': 0.6180000000000001}
                ]

series9_mtfs = [{'accuracy': 0.3276190476190476,
                 'forward_transfer': 0.054000000000000006,
                 'backward_transfer_pos': 0,
                 'remembering': 0.15866666666666662},
                {'accuracy': 0.20190476190476192,
                 'forward_transfer': 0.0033333333333333335,
                 'backward_transfer_pos': 0,
                 'remembering': 0.1379999999999999},
                {'accuracy': 0.17857142857142858,
                 'forward_transfer': 0.036000000000000004,
                 'backward_transfer_pos': 0,
                 'remembering': 0.42800000000000005},
                ]

for mtf_dicts in [series4_mtfs,
                  # series5_mtfs,
                  # series6_mtfs,
                  # series7_mtfs,
                  series8_mtfs,
                  series9_mtfs,
                  ]:
    avg_dict = {}
    for key in mtf_dicts[0].keys():
        avg_dict[key] = np.average([d[key] for d in mtf_dicts])
    print("average mtf:", avg_dict)
